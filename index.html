// ğŸ”¥ ä¿®æ­£ ReferenceError çš„é—œéµå‡½å¼
function submitTopic() {
    const t = document.getElementById('input-topic').value;
    if(!t) return alert("è«‹è¼¸å…¥ä¸»é¡Œ");
    // ç¢ºä¿å‘¼å« startGen è€Œä¸æ˜¯ handleTopicGeneration
    startGen('generate', { 
        topic: t, 
        level: document.getElementById('input-level').value, 
        len: 'medium', 
        scenario: document.getElementById('input-scenario').value 
    });
}

function startGen(act, data) {
    document.getElementById('loading-msg').classList.remove('hidden');
    callApi(act, data).then(res => {
        document.getElementById('loading-msg').classList.add('hidden');
        currentCards = res.data.cards; currentIndex = 0;
        currentArticleText = currentCards.map(c => c.english).join(' ');
        currentArticleTitle = res.data.title || 'New Lesson';
        
        document.getElementById('view-input').classList.add('hidden');
        document.getElementById('view-cards').classList.remove('hidden');
        document.getElementById('view-cards').classList.add('flex');
        renderCard();
    });
}

// ğŸ™ï¸ æ ¸å¿ƒï¼šAI å—“éŸ³èˆ‡å‚™æ´æ¨¡å¼ (å°æ¥æ–°çš„ API)
async function speak(txt, version = 'A_Professional') {
    if (!txt) return;
    window.speechSynthesis.cancel();
    const oldAudio = document.getElementById('ai-audio-player');
    if (oldAudio) oldAudio.pause();

    try {
        const res = await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({ action: 'tts', text: txt, version: version })
        });
        const json = await res.json();
        if (json.status === 'success' && json.audioUrl) {
            let player = document.getElementById('ai-audio-player') || document.createElement('audio');
            player.id = 'ai-audio-player';
            if (!player.parentElement) document.body.appendChild(player);
            player.src = json.audioUrl;
            player.play();
        } else { throw new Error("TTS Failed"); }
    } catch (e) {
        console.warn("å‚™æ´æ¨¡å¼å•Ÿå‹•", e.message);
        const u = new SpeechSynthesisUtterance(txt);
        u.lang = 'en-US'; u.rate = 0.9;
        window.speechSynthesis.speak(u);
    }
}
